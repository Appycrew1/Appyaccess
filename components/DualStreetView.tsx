"use client";
import { useEffect, useRef } from "react";import { useGoogleMaps } from "./GoogleLoader";import type { PlaceLite } from "@/types";
export default function DualStreetView({origin,destination}:{origin:PlaceLite|null;destination:PlaceLite|null}){const ready=useGoogleMaps();const leftRef=useRef<HTMLDivElement|null>(null);const rightRef=useRef<HTMLDivElement|null>(null);const svsRef=useRef<google.maps.StreetViewService|null>(null);const panoLeftRef=useRef<google.maps.StreetViewPanorama|null>(null);const panoRightRef=useRef<google.maps.StreetViewPanorama|null>(null);useEffect(()=>{if(!ready)return;if(!svsRef.current)svsRef.current=new google.maps.StreetViewService();},[ready]);useEffect(()=>{if(!ready||!svsRef.current)return;const load=(p:PlaceLite|null,el:HTMLElement|null,store:{current:google.maps.StreetViewPanorama|null})=>{if(!p||!el){if(store.current)store.current.setVisible(false);return;}const loc={lat:p.lat,lng:p.lng};svsRef.current!.getPanorama({location:loc,radius:70},(data,status)=>{if(status===google.maps.StreetViewStatus.OK&&data?.location?.latLng){if(!store.current){store.current=new google.maps.StreetViewPanorama(el,{position:data.location.latLng,pov:{heading:0,pitch:0},visible:true});}else{store.current.setPosition(data.location.latLng);store.current.setVisible(true);}}else{if(store.current)store.current.setVisible(false);if(el)el.innerHTML='<div class="p-4 text-sm" style="opacity:.7">No Street View available here.</div>';}});};load(origin,leftRef.current,panoLeftRef);load(destination,rightRef.current,panoRightRef);},[origin?.place_id,destination?.place_id,ready]);return (<div className="grid md:grid-cols-2 gap-4"><div className="card" style={{height:'20rem',overflow:'hidden'}}><div className="p-2 text-xs" style={{opacity:.7}}>Origin Street View</div><div ref={leftRef} style={{height:'calc(100% - 28px)'}} /></div><div className="card" style={{height:'20rem',overflow:'hidden'}}><div className="p-2 text-xs" style={{opacity:.7}}>Destination Street View</div><div ref={rightRef} style={{height:'calc(100% - 28px)'}} /></div></div>);}
