export async function fetchArcGISRoadworks(lat:number,lng:number,radiusKm=5){const env=process.env.BOROUGH_ARCGIS_URLS;if(!env)return[];const layers=env.split(",").map(s=>s.trim()).filter(Boolean);const km=radiusKm;const dLat=km/110.574;const dLng=km/(111.320*Math.cos(lat*Math.PI/180));const bbox=[lng-dLng,lat-dLat,lng+dLng,lat+dLat].join(",");const results:any[]=[];for(const base of layers){const url=`${base}/query?where=1%3D1&outFields=*&f=json&inSR=4326&outSR=4326&geometry=${bbox}&geometryType=esriGeometryEnvelope&spatialRel=esriSpatialRelIntersects`;try{const r=await fetch(url,{cache:"no-store"});if(!r.ok)continue;const json=await r.json();const feats=json.features||[];for(const f of feats)results.push({layer:base,feature:f});}catch{}}return results;}
