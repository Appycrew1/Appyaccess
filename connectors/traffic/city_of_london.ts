import * as cheerio from "cheerio";import { aiExtract } from "@/lib/aiExtract";
export async function fetchCityClosures(url?:string){const page=url||process.env.CITY_CLOSURES_URL;if(!page)return[];try{const r=await fetch(page,{cache:"no-store"});if(!r.ok)return[];const html=await r.text();const $=cheerio.load(html);const rows=$("table tr").map((_,tr)=>$(tr).find("td,th").map((_,td)=>$(td).text().trim()).get()).get().filter((r:any)=>Array.isArray(r)&&r.length>1);if(rows.length>1){return rows.map((cols:string[])=>({title:cols.join(" | "),source:page}));}const ai=await aiExtract<any[]>("You extract road closure items from HTML text.",html,'[{"title":"string","date?":"string","location?":"string","notes?":"string"}]');return ai||[];}catch{return[];}}
